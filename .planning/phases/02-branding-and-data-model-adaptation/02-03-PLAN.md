---
phase: 02-branding-and-data-model-adaptation
plan: 03
type: execute
wave: 2
depends_on: ["02-02"]
files_modified:
  - back-end/src/modules/users/types/donor.types.ts
  - back-end/src/modules/projects/types/adoption.types.ts
  - front-end/src/types/donor.types.ts
  - front-end/src/types/adoption.types.ts
  - front-end/src/features/dashboard/overview/kpi/index.tsx
  - front-end/messages/dashboard/overview/en.json
autonomous: true

must_haves:
  truths:
    - "Backend has Donor type alias for User entity and CoralAdoption type alias for Project entity"
    - "Frontend has matching Donor and CoralAdoption type definitions for API responses"
    - "Dashboard overview KPI section displays NGO metrics (Total Donors, Active Adoptions, Total Giving, Restoration Sites)"
    - "KPI cards show meaningful NGO-relevant trend data"
  artifacts:
    - path: "back-end/src/modules/users/types/donor.types.ts"
      provides: "Donor type alias and DonorProfile interface"
      contains: "export type Donor"
    - path: "back-end/src/modules/projects/types/adoption.types.ts"
      provides: "CoralAdoption type alias and AdoptionFulfillment interface"
      contains: "export type CoralAdoption"
    - path: "front-end/src/types/donor.types.ts"
      provides: "Frontend Donor type definitions"
      contains: "Donor"
    - path: "front-end/src/types/adoption.types.ts"
      provides: "Frontend Adoption type definitions"
      contains: "Adoption"
  key_links:
    - from: "back-end/src/modules/users/types/donor.types.ts"
      to: "back-end/src/modules/users/entities/user.entity.ts"
      via: "import User"
      pattern: "import.*User.*user\\.entity"
    - from: "back-end/src/modules/projects/types/adoption.types.ts"
      to: "back-end/src/modules/projects/entities/project.entity.ts"
      via: "import Project"
      pattern: "import.*Project.*project\\.entity"
---

<objective>
Create TypeScript type aliases mapping NGO domain terminology to existing entities (Donor = User, CoralAdoption = Project) and adapt the dashboard overview KPI section to display NGO-relevant metrics.

Purpose: Establishes semantic clarity in the codebase (developers think in "donors" and "adoptions") while preserving all existing infrastructure. The KPI adaptation makes the dashboard overview immediately useful for NGO operations.
Output: Type alias files on both backend and frontend, KPI section showing Total Donors / Active Adoptions / Total Giving / Restoration Sites.
</objective>

<execution_context>
@/Users/ludovicgoutel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ludovicgoutel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-branding-and-data-model-adaptation/02-RESEARCH.md

Key existing files:
@back-end/src/modules/users/entities/user.entity.ts
@back-end/src/modules/projects/entities/project.entity.ts
@front-end/src/features/dashboard/overview/kpi/index.tsx
@front-end/messages/dashboard/overview/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create backend and frontend type aliases</name>
  <files>
    back-end/src/modules/users/types/donor.types.ts
    back-end/src/modules/projects/types/adoption.types.ts
    front-end/src/types/donor.types.ts
    front-end/src/types/adoption.types.ts
  </files>
  <action>
1. Create back-end/src/modules/users/types/donor.types.ts:
```typescript
import { User } from '../entities/user.entity';

/**
 * Semantic alias: Donor is a User in the Coral Gardeners NGO context.
 * Use Donor in business logic and API responses.
 * Use User only when interacting with the database layer directly.
 */
export type Donor = User;

/**
 * Donor with computed NGO-specific fields.
 * Used in API responses that include aggregated data.
 */
export interface DonorProfile {
  id: number;
  username: string;
  first_name: string;
  last_name: string;
  email: string;
  phone?: string;
  profile_picture?: string;
  country_id?: number;
  country?: { name: string; code: string };
  lifetimeGiving: number;
  lastDonationDate?: Date;
  adoptionCount: number;
  engagementScore?: number;
  isActive: boolean;
  created_at: Date;
  updated_at: Date;
}

/**
 * Lightweight DTO for donor list views.
 */
export interface DonorListItem {
  id: number;
  name: string;
  email: string;
  phone?: string;
  country?: string;
  lifetimeGiving: number;
  adoptionCount: number;
  isActive: boolean;
  joinedDate: Date;
}
```

2. Create back-end/src/modules/projects/types/adoption.types.ts:
```typescript
import { Project } from '../entities/project.entity';

/**
 * Semantic alias: CoralAdoption is a Project in the Coral Gardeners NGO context.
 * Use CoralAdoption in business logic and API responses.
 * Use Project only when interacting with the database layer directly.
 */
export type CoralAdoption = Project;

/**
 * Adoption fulfillment tracking.
 * Each adoption goes through: naming -> certificate -> site assignment.
 */
export interface AdoptionFulfillment {
  isNamed: boolean;
  coralName?: string;
  certificateIssued: boolean;
  certificateUrl?: string;
  siteAssigned: boolean;
  siteName?: string;
  siteCoordinates?: { lat: number; lng: number };
}

/**
 * Full adoption details for detail views.
 */
export interface AdoptionDetails {
  id: number;
  coralName: string;
  description: string;
  status: 'in-progress' | 'ready' | 'blocked';
  restorationSite: string;
  donorId?: number;
  donorName?: string;
  fulfillment: AdoptionFulfillment;
  adoptionDate: Date;
  image?: string;
  created_at: Date;
  updated_at: Date;
}

/**
 * Lightweight DTO for adoption list views.
 */
export interface AdoptionListItem {
  id: number;
  coralName: string;
  restorationSite: string;
  status: string;
  donorName?: string;
  isFulfilled: boolean;
  adoptionDate: Date;
}
```

3. Create front-end/src/types/donor.types.ts:
```typescript
/**
 * Frontend Donor types - mirrors backend DonorProfile.
 * Used in components and API response typing.
 */
export interface Donor {
  id: number;
  username: string;
  first_name: string;
  last_name: string;
  email: string;
  phone?: string;
  profile_picture?: string;
  country?: { name: string; code: string };
  lifetimeGiving?: number;
  lastDonationDate?: string;
  adoptionCount?: number;
  isActive: boolean;
  created_at: string;
  updated_at: string;
  deleted_at?: string;
}

export interface DonorListItem {
  id: number;
  name: string;
  email: string;
  phone?: string;
  country?: string;
  lifetimeGiving: number;
  adoptionCount: number;
  isActive: boolean;
  joinedDate: string;
}
```

4. Create front-end/src/types/adoption.types.ts:
```typescript
/**
 * Frontend Adoption types - mirrors backend AdoptionDetails.
 * Used in components and API response typing.
 */
export interface CoralAdoption {
  id: number;
  coralName: string;
  description: string;
  status: 'in-progress' | 'ready' | 'blocked';
  restorationSite: string;
  donorId?: number;
  donorName?: string;
  fulfillment: AdoptionFulfillment;
  image?: string;
  created_at: string;
  updated_at: string;
  deleted_at?: string;
}

export interface AdoptionFulfillment {
  isNamed: boolean;
  coralName?: string;
  certificateIssued: boolean;
  certificateUrl?: string;
  siteAssigned: boolean;
  siteName?: string;
}

export interface AdoptionListItem {
  id: number;
  coralName: string;
  restorationSite: string;
  status: string;
  donorName?: string;
  isFulfilled: boolean;
  adoptionDate: string;
}
```

IMPORTANT: These are TYPE FILES ONLY. Do NOT modify existing entity files, controllers, or services. These types provide semantic clarity for FUTURE feature development and for Plan 04's CSV import/export features.
  </action>
  <verify>
    - ls back-end/src/modules/users/types/donor.types.ts should exist
    - ls back-end/src/modules/projects/types/adoption.types.ts should exist
    - ls front-end/src/types/donor.types.ts should exist
    - ls front-end/src/types/adoption.types.ts should exist
    - grep "export type Donor" back-end/src/modules/users/types/donor.types.ts should match
    - grep "export type CoralAdoption" back-end/src/modules/projects/types/adoption.types.ts should match
    - TypeScript compilation: cd back-end && npx tsc --noEmit (should not introduce new errors)
  </verify>
  <done>Type alias files exist on both backend and frontend, Donor maps to User, CoralAdoption maps to Project, AdoptionFulfillment interface defined with isNamed/certificateIssued/siteAssigned booleans</done>
</task>

<task type="auto">
  <name>Task 2: Adapt dashboard overview KPI section for NGO metrics</name>
  <files>
    front-end/src/features/dashboard/overview/kpi/index.tsx
    front-end/messages/dashboard/overview/en.json
  </files>
  <action>
1. First read the existing KPI component at front-end/src/features/dashboard/overview/kpi/index.tsx to understand its structure. It likely fetches stats from the backend and displays stat cards.

2. Adapt the KPI section to display 4 NGO-relevant metrics:
   a. **Total Donors** - mapped from total users count
   b. **Active Adoptions** - mapped from total projects count
   c. **Total Giving** - display a formatted currency amount (use mock data for now since no real financial tracking exists yet)
   d. **Restoration Sites** - display count of unique environments/sites

   The approach depends on how the existing KPI works:
   - If it uses hardcoded metric definitions: Update the metric labels, icons, and descriptions
   - If it fetches from API: Update the labels and formatting, keep the API calls
   - If it uses i18n keys: Update the i18n file (already done in Plan 02), just verify the KPI reads from correct keys

   For each KPI card, update:
   - Title/label to NGO terminology
   - Icon to relevant one (IconUsers for donors, IconHeart for adoptions, IconCurrencyDollar for giving, IconMapPin for sites)
   - Import icons from @tabler/icons-react
   - Trend descriptions to NGO context

3. If the KPI component uses hardcoded labels (not i18n), add i18n keys to front-end/messages/dashboard/overview/en.json under a "kpi.metrics" section:
```json
"metrics": {
  "totalDonors": {
    "label": "Total Donors",
    "description": "All registered donors"
  },
  "activeAdoptions": {
    "label": "Active Adoptions",
    "description": "Currently active coral adoptions"
  },
  "totalGiving": {
    "label": "Total Giving",
    "description": "Lifetime donation revenue"
  },
  "restorationSites": {
    "label": "Restoration Sites",
    "description": "Active coral restoration locations"
  }
}
```

4. If the KPI data comes from a stats API endpoint, keep the existing API integration. Just update how the response data is labeled and displayed. The actual data values will be populated with real data in Phase 3 (seeding).

IMPORTANT: The KPI section must still compile and render. If the existing component fetches real data from the backend, keep that working. Just change labels and presentation. Do NOT break existing API integrations.
  </action>
  <verify>
    - The KPI component file has no TypeScript errors: search for import errors or undefined references
    - grep "Donor\|Adoption\|Giving\|Restoration" front-end/src/features/dashboard/overview/kpi/index.tsx should return matches (or the i18n file should)
    - The overview page should still be renderable (no import errors)
  </verify>
  <done>Dashboard overview KPI section displays 4 NGO-relevant metrics (Total Donors, Active Adoptions, Total Giving, Restoration Sites) with appropriate icons and labels</done>
</task>

</tasks>

<verification>
1. All 4 type files exist and contain correct type definitions
2. Backend type files import from correct entity paths
3. KPI section references NGO metrics (donors, adoptions, giving, sites)
4. No TypeScript compilation errors introduced
5. No existing API integrations broken
</verification>

<success_criteria>
- Donor type alias exists on backend mapping to User entity
- CoralAdoption type alias exists on backend mapping to Project entity
- AdoptionFulfillment interface has isNamed, certificateIssued, siteAssigned booleans
- Frontend type files mirror backend types for API response typing
- Dashboard overview KPI shows 4 NGO metrics with appropriate labels and icons
- No breaking changes to existing entity files, controllers, or services
</success_criteria>

<output>
After completion, create `.planning/phases/02-branding-and-data-model-adaptation/02-03-SUMMARY.md`
</output>
